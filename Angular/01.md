# Angular 9 : D√©couverte de Angular - Cours
> - [Retourner √† la liste des cours](../readme.md)
> - Exercices : [cliquez-ici](exercices.md)
> - Corrections : [cliquez-ici](corrections.md)

> Angular est un framework Javascript qui permet de composer des applications web de type SPA (Single Page Application). 

> Nous allons voir les concepts cl√©s et tout ce que vous avez besoin de savoir  pour construire votre premi√®re application Angular.

## 1. Vue d'ensemble

### Pr√©sentation de Angular

Jusqu'√† pr√©sent, vous savez d√©velopper un site en HTML/CSS et en Javascript. Depuis les d√©buts du web, des technologies sont venues en surcouche √† ces trois langages de base pour rendre les pages plus accessibles, dynamiques, modernes.

Autour de 2005, la technologie AJAX est arriv√©e (Asynchronous Javascript And XML) qui permettait d'ex√©cuter des requ√™tes HTTP (c'est √† dire demander quelque chose √† un serveur web) sans recharger la page ! Jusque alors, la seule mani√®re que nous avions d'afficher un contenu diff√©rent dans une page, c'√©tait de faire des liens en HTML vers une autre page contenant les nouvelles donn√©es.

Avec AJAX, on √©tait alors capables de faire quelque chose de novateur : ex√©cuter cette demande de nouveau contenu (donc, cette requ√™te, qu'on appelle une requ√™te HTTP), alors m√™me que nous restions sur la m√™me page !

Aujourd'hui les requ√™tes AJAX restent tr√®s utilis√©es. Par exemple sur Twitter: lorsque vous scrollez tout en bas de la page d'accueil, un √©v√®nement est d√©clanch√© en Javascript lorsque vous touchez le bas de la page, et la fonction d√©clanch√©e √† ce moment dit quelque chose comme : "r√©cup√®re-moi les tweets suivants et ajoute-les √† la suite, dans le DOM". Et tout √ßa, sans recharger la page !

Il y aussi jQuery, qui est cr√©√© vers 2006 : en fait, jQuery n'ajoute pas vraiment de fonctionnalit√©s (l√† o√π AJAX est une r√©elle nouvelle technologie), en fait, il nous permet d'utiliser ce que  Javascript nous permet d√©j√† mais... plus facilement et de fa√ßon optimis√©e par rapport √† ce que les navigateurs permettaient √† l'√©poque !

On commence alors √† savoir faire des sites web int√©ressants gr√¢ce √† Javascript, qui auparavant √©tait plut√¥t boud√© des d√©veloppeurs car peu optimis√© et servant surtout √† de l'appar√¢t visuel plus qu'√† des fonctionnalit√©s r√©elles.

Arrive vers 2010 AngularJS, la premi√®re version de Angular, par Google. C'est enfin une bo√Æte √† outils compl√®te, un framework, qui permet de d√©velopper des SPA (Single Page Applications), c'est √† dire des applications web contenues sur une seule page dynamique. L'avantage d'utiliser un framework pour cela, c'est qu'il nous donne une s√©rie de conventions et une ligne de conduite √† tenir pour coder et organiser notre projet.

√Ä partir de la version 2, AngularJS (donc, la version 1), est renomm√©e Angular. C'est une r√©√©criture compl√®te du framework pour le simplifier et l'optimiser grandement. Nous en sommes aujourd'hui √† la version 9 !

### Pourquoi Angular ?

Depuis, de nombreux autres frameworks ont vu le jour : Angular, mais aussi React, Vue.js pour les plus utilis√©s.

> Tous ont leurs avantages et inconv√©nients, et comme souvent en programmation : **soyez agnostiques !** Choisissez vos outils en fonction de vos besoins, et ensuite en fonction de vos go√ªts.

- Angular est un framework tr√®s robuste, dont la courbe d'apprentissage peut effrayer. En fait, Angular est plus difficile √† aborder de prime abord mais on se retrouve avec des comp√©tences et des bonnes pratiques qui acc√©l√®rent nettement le d√©veloppement de notre projet par la suite !

![react/angular/vue](img/angular_vs_react_vs_vue.png)

- Angular permet de bien structurer ses fonctionnalit√©s (les composants) et poss√®de un robuste ensemble d'outils pr√™ts √† l'emploi (un routeur, un moteur de template, du stockage local, une gestion des erreurs pouss√©e...)

- React, de base, ne poss√®de que la partie composants et templating. Il est pratique pour cr√©er des composants isol√©s dans votre site.

- Vue est int√©ressant pour transformer une application web d√©j√† existante, morceau par morceau, l√† o√π Angular est un projet complet d√®s le d√©part

- Angular utilise Typescript !

### Euh, Typescript ?

Typescript est √† Javascript ce que SASS est √† CSS : c'est un "sur-langage" qui sera transtyp√©, ou "traduit", en Javascript. Pourquoi l'utiliser ? Car l'un des reproches fait √† Javascript est son c√¥t√© tr√®s laxiste, permissif et peu coh√©rent dans sa structure, qui laisse passer trop facilement un code bugu√© ou mal optimis√©. En fait, Typescript est un Javascript en tr√®s strict ! Il ne laisse passer aucune erreur (l'application ne fonctionnera simplement pas !), ce qui vous force √† coder mieux et plus proprement... Pour au final, avoir un code mieux organis√© et plus maintenable.

## Les outils n√©cessaires
Les frameworks Javascript utilisent Node et NPM pour g√©rer leurs d√©pendances, c'est √† dire l'ensemble des outils n√©cessaires √† leur fonctionnement.

### Node.js
Node.js est un serveur web (√† l'oppos√© d'un client web qui demande des pages web, le serveur web distribue des pages web) √©crit en Javascript. Bien que Angular soit bel et bien une technologie de front (donc, c√¥t√© client), nous avons besoin de Node.js pour utiliser des outils de ligne de commande qui nous permettront de "compiler" notre code, c'est √† dire transformer le code source en un code compr√©hensible par le navigateur web.

### NPM
NPM (Node Package Manager) est l'outil de gestions de d√©pendances de Node.js. Un gestionnaire de d√©pendances, c'est en fait un outil qui va lire la liste des d√©pendances de notre projet (par exemple: j'ai besoin d'un outil de traduction, de Boostrap, de telle et telle librairies...).

On peut consulter les packages (ou paquets, ou d√©pendances, ou libraries, ou biblioth√®ques) sur le site de NPM : https://www.npmjs.com/

L'avantage d'un gestionnaire de d√©pendances, c'est qu'avec quelques lignes de commandes, il maintiendra √† jour toutes les d√©pendances du projet ! C'est nettement plus simple que d'avoir plein de lignes `script` ou `link` et de devoir v√©rifier pour chaque d√©pendance CSS ou JS s'il y a une mise √† jour.

L'int√©r√™t aussi est de "g√©rer les d√©pendances" : par exemple, j'ai besoin de la librairie DataTables pour rendre mes tableaux triables en Javascript. Cette d√©pendance a elle-m√™me besoin de jQuery. Jusqu'√† pr√©sent, je devais d'abord importer jQuery dans mon code puis importer DataTables pour que tout fonctionne.

Avec NPM, je peux simplement indiquer que j'ai besoin de DataTables pour qu'il s'occupe d'importer toutes les sous-d√©pendances !

> Exemple: allez jeter un oeil sur les d√©pendances du paquet [@angular/cli](https://www.npmjs.com/package/@angular/cli). En requ√©rant ce package, il y a  20 autres d√©pendances qui s'installeront automatiquement et qui se maintiendront √† jour toutes seules !

### Installation

- T√©l√©chargez et installez la derni√®re version **LTS** de Angular : https://nodejs.org/en/download/
- Une fois install√©, ouvrez un terminal et tapez `node -v` (comme "version") : si une version de Node s'affiche, c'est que tout fonctionne ! Sinon, il a probablement un bug.
![nodev](img/nodev.png)

- Ensuite, saisissez `npm install -g npm@latest` pour installer la derni√®re version de NPM sur votre machine. Une fois l'installation termin√©e, v√©rifiez si la version appara√Æt avec `npm -v` :
![npmv](img/npmv.png)

- Enfin, installez la ligne de commande de Angular sur votre machine avec : `npm install -g @angular/cli`

> - `npm`, c'est l'outil, le gestionnaire de package
> - `install`, c'est pour installer une d√©pendance
> - `-g`, c'est pour l'installer de partout dans la machine et non pas seulement dans le dossier actuel du terminal
> -`@angular`, c'est le d√©veloppeur de la d√©pendance
> - `cli`, c'est le nom de la d√©pendance !

Une fois install√©, v√©rifiez la version, cette fois avec... `ng version` (Pourquoi pas `-v` ? Aucune id√©e !)

![ng version](img/ngversion.png)

√áa y est, les outils sont pr√™ts !

## Notre premi√®re application Angular

Pour commencer, cr√©ez un dossier dans lequel vous stockerez vos projets Angular. Il peut √™tre n'importe o√π dans votre ordinateur, mais √©vitez de le mettre dans un dossier qui est g√©r√© par un drive (Dropbox, Google Drive, One Drive, iCloud...).

> En fait, on aura des dizaines de milliers de fichiers (hein, quoi ? Oui oui) qui vont s'installer pour g√©rer notre projet. Rappellez-vous le gestionnaire de d√©pendances ! Un paquet d√©pend de plusieurs autres, qui eux-m√™me d√©pendent de plusieurs autres... et ainsi de suite !

> Mais alors, comment je sauvegarde ou partage mon projet du coup ? √áa, √ßa sera le r√¥le de Git !

Ouvrez maintenant ce dossier avec un terminal :
- Sous Windows, ouvrez le dossier en question puis cliquez dans la barre d'adresses du dossier. Dedans, saisissez `cmd` : un terminal s'ouvrira pile dans le bon dossier !

- Sous Mac, ouvrez `Terminal` puis naviguez jusqu'au dossier en question. Pour cela :
  - `ls` permet de visualiser le dossier en cours
  - `cd nomDuDossier` permet de rentrer dans le dossier `nomDuDossier`
  - `cd ..` permet de remonter d'un cran dans l'arobrescence de dossiers 
  - Par exemple, pour aller dans le dossier `projects` :
![cd et ls](img/cdprojects.png)

Ensuite, une fois dans ce dossier, saisissez la commande suivante :

`ng new firstProject --style=scss --skip-tests=true`
Puis saisissez `y` √† la question pos√©e.

![ng new](img/ngnew.png)

Un dossier `firstProject` contenant des tas de fichiers et dossiers va se cr√©er ! Cela prend plus ou moins de temps la premi√®re fois.

Ici, on cr√©√©e donc un projet gr√¢ce √† `ng new` que l'on nomme `firstProject`. On ajoute des options facultatives qui nous permettent de pr√©ciser que nous utiliserons SASS pour les CSS et que nous ne souhaitons pas utiliser les tests unitaires de Angular (ce sont des fichiers o√π nous d√©finissons un comportement de l'application afin de v√©rifier si ce comportement marche ou pas).

## Notre premier projet !

√áa y est, nous y sommes ! Notre premier projet Angular est maintenant cr√©√©. Vous allez maintenant l'ouvrir dans Visual Studio Code.

> **ATTENTION !** Faites extr√™mement attention √† ce qui va suivre. Promis, c'est facile ! Visual Studio Code ou tout autre IDE ne fonctionne bien que si, et seulement si, vous respectez la consigne suivante : vous devez **obligatoirement** ouvrir le dossier du projet dans lequel vous travaillez, dans VSCode !

Voici une fen√™tre VSCode de base :
![VSCode](img/vscodebase.png)

Cliquez sur `Open Folder` ou `Fichier > Ouvrir un dossier` ou `Files > Open Folder` afin d'ouvrir le dossier `firstProject`.

C'est vraiment tr√®s important, soyez vigilants ! Il ne faut pas ouvrir non plus un dossier en dessus (par exemple, s'il est stock√© dans `C:\Mes Documents\cours\firstProject`, vous ne devez pas ouvrir `cours` mais bien `firstProject` !)

Pour √™tre bien s√ªrs, vous devez avoir le dossier `firstProject` indiqu√© comme ci-dessous :

![firstProject](img/vscodeFirstProject.png)

> Cette pratique est √† respecter dor√©navant pour tous le code que nous verrons ensemble √† l'avenir, car nous travaillerons uniquement en mode "projet" et plus sur des fichiers isol√©s !

### Installer une premi√®re d√©pendance

Maintenant que votre VSCode est ouvert au bon endroit, vous pouvez ouvrir un terminal, cette fois directement dans VSCode. Vous pouvez aller dans `Terminal > New Terminal` (le raccourci clavier est indiqu√© sur le bouton, retenez-le car on va s'en servir tr√®s souvent üòâ)

> Vous pouvez remarquer que le terminal est d√©j√† ouvert au bon endroit, c'est un des avantages d'ouvrir le dossier du projet correctement !
![VSCode Terminal](img/vscodeterminal.png)

Indiquons dans le terminal que nous allons utiliser Boostrap :

```
npm i boostrap
```

> Cette fois, pas de `-g` ! Je ne veux pas installer Boostrap sur toute ma machine (bien que Windows stylis√© en Boostrap peut √™tre... Euh, je m'√©gare l√†), mais uniquement dans le projet en cours, c'est √† dire celui dont j'ai le dossier d'ouvert.

> Et cette fois, `i` plut√¥t que `install` ! C'est juste un raccourci.

![npm i bootstrap](img/npmibootstrap.png)

Jetez un oeil √† `package.json` : ce fichier contient la liste des d√©pendances de notre projet. De base, Angular a besoin de beaucoup d'outils pour fonctionner ! En fouillant un peu, on peut voir notre nouvelle d√©pendance :

![composer.json Bootstrap](img/composerjsonbootstrap.png)

#### Euh, mais √ßa s'installe o√π tout √ßa ?

Parmi tous les fichiers et dossiers du projet, un dossier est gris√© : c'est `node_modules`. C'est dans ce dossier que toutes les d√©pendances seront install√©es. **Il est interdit d'y toucher !** Vous ne pouvez pas modifier les fichiers qui s'y trouvent ! En fait, comme NPM g√®re toutes ces d√©pendances, en cas de mise √† jour (et avec tous ces paquets, il en a beaucoup), il va simplement effacer vos modifications au profit de la version publique de la d√©pendance. Il existe d'autres mani√®res de faire lorsque nous avons besoin de modifier une d√©pendance, mais √ßa viendra plus tard !

C'est aussi dans ce dossier o√π se trouvent plusieurs milliers de fichiers (61 000 pour l'instant !).

S'il est gris√©, c'est que Git, qui est d√©j√† pr√©sent dans le projet (`ng new` a fait √ßa seul !) ne le pr√©voit pas dans sa sauvegarde. En effet, on n'a pas du tout besoin de partager ce dossier `node_modules` ni de l'enregistrer o√π que ce soit quand on partage/sauvegarde le projet !

Pourquoi ?

Eh bien car nous avons `package.json` qui contient d√©j√† la liste des d√©pendances ! Ainsi, il est bien plus simple de se partager le projet sans `node_modules` et de s'envoyer plut√¥t le projet avec `package.json`. Il suffira une fois le projet r√©cup√©r√©, de faire `npm install` dans le dossier du projet pour que NPM lise `package.json` et installe toutes les d√©pendances !

### D√©clarer Bootstrap dans le projet

Pour que Angular prenne notre Bootstrap (install√© dans node_modules donc) en style, modifiez le fichier `src/angular.json` et ajoutez modifiez le tableau `"styles"` en ajoutant la ligne suivante :

```
"node_modules/bootstrap/dist/css/bootstrap.min.css",
```

![add style](img/angularjsonstyle.png)

### Lancer notre projet Angular

Bon, √† quoi √ßa ressemble Angular au fait ? Lan√ßons le projet pour savoir !

Vu le nombre de fichiers, on se demande comment tout cela fonctionne. O√π se trouve `index.html` ? O√π sont les css, les js, √† quoi servent tous ces dossiers ?! En fait, Angular va compiler tous ces fichiers en un projet qui sera distribu√© sur un serveur web. Et pour cela, vous allez saisir la commande suivante :

```bash
ng serve --open
```

Apr√®s quelques moulinages, une page de votre navigateur devrait s'ouvrir (gr√¢ce √† `--open`) ! Il s'agit de `localhost:4200` : c'est un serveur qui a √©t√© cr√©√© localement (localhost, c'est votre machine), sur le port 4200.

Bravo, votre premier projet Angular est lanc√©. Il ne manque plus qu'√† le personnaliser !

> Profitez d'√™tre sur cette page pour d√©couvrir de nouvelles lignes de commande et d√©couvrir la documentation de Angular !

> On remarque que les boutons sont moches : en fait, c'est √† cause du style Bootstrap que nous avons import√©. Eh oui, quelle id√©e nous avons eu l√†, Angular vient d√©j√† avec son style (Material Design) !

![Boutons moches](img/boutons-moches.png)

Une fois les liens √©tudi√©s, allons modifier cette page : il s'agit du fichier `src/app/app.component.html`.

--- 
### Exercice
> Supprimez tout (oui, tout !) le contenu de ce fichier et √©crivez un simple `<h1>Hello World</h1>`. Actualisez... Euh non, n'actualisez pas : la page devrait s'actualiser toute seule √† chaque sauvegarde de fichier !
--- 


## Notre premier component

Angular est compos√© en *components*. Ce sont des petites briques d'√©l√©ments sur la page qui sont r√©utilisables et qui auront chacune une fonctionnement qui lui est propre. 

![Components: sch√©ma](img/angular-components-schema.png)

C'est un peu comme `body` ou `div` en HTML, mais en bien mieux !

Le component le plus  √©lev√©, c'est `app-root`. On pr√©fixe par convention les noms des components par `app`.

Dedans, on peut avoir un component pour la barre de navigation, pour un bloc de donn√©es (dans l'exemple, la liste de t√¢ches), pour une seule donn√©e qui sera r√©p√©t√©e (dans l'exemple, une t√¢che elle-m√™me)...

Un des avantages, c'est que notre code pourra √™tre s√©par√© en plusieurs petits √©l√©ments, et plut√¥t que d'avoir un seul fichier HTML avec 400 lignes de code, nous aurons plut√¥t cinq ou six fichiers HTML avec beaucoup moins de code !

Au del√† de diviser notre code, les components permettent des interactions entre eux et des fonctionnements qui rendront dynamiques nos pages. Par exemple, comme dans l'image : vous voulez cliquer sur le lien "Completed Tasks" pour voir les t√¢ches compl√©t√©es ? Tr√®s bien, au lieu de recharger toute la page, on n'a qu'√† changer le component des t√¢ches !


Pour cr√©er votre premier component, commencez par quitter le serveur afin d'avoir de nouveau acc√®s √† la ligne de commande. Pour cela, en √©tant dans le terminal, faites `ctrl+c`.

Maintenant, cr√©ez votre premier component : 

```
ng generate component tasks-list
```

Ou en raccourci :
```
ng g c tasks-list
```

La ligne de commande devait vous indiquer que trois fichiers ont √©t√© cr√©√©s et un fichier a √©t√© mis √† jour : un dossier `tasks-list` a √©t√© cr√©√© et contient tout cela !

Int√©grons ce composant dans notre page d'accueil en modifiant `app.component.html` :

![first component integration](img/firstcomponent-integration.png)

Votre page devrait afficher quelque chose comme √ßa :

![Hello world](img/helloworld.png)